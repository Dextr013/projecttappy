(()=>{async function G(){if(window.YaGames||await new Promise(t=>setTimeout(t,300)),!window.YaGames)throw new Error("YaGames not loaded");return await window.YaGames.init()}function T(r){let t=r.environment||{};return{appId:t.app&&t.app.id||"unknown",lang:t.i18n&&t.i18n.lang||"ru",tld:t.i18n&&t.i18n.tld||"ru",payload:t.payload||null}}async function A(r,t,e){try{let s=await r.getFlags({defaultFlags:t,clientFeatures:e});return{...t,...s||{}}}catch(s){return console.warn("getFlags failed, using defaults",s),t}}var J=Math.PI*2,I=class{constructor({canvas:t,assets:e,audio:s,flags:n,onScore:a,onDeath:o,onStart:l,onPause:u,onResume:f,onDistance:x,onOvertake:L,selectedSkin:m="blue",skins:k,strings:v}){this.canvas=t,this.ctx=t.getContext("2d"),this.assets=e,this.audio=s,this.flags=n,this.onScore=a,this.onDeath=o,this.onStart=l,this.onPause=u,this.onResume=f,this.onDistance=x,this.onOvertake=L,this.metersPerPixel=this.flags.metersPerPixel||.2,this.distanceMeters=0,this.skins=k||{},this.currentSkin=m,this.ghosts=[],this.strings=v||{pressStart:"Press start",pause:"Paused",collision:"Collision"},this.state="menu",this.score=0,this.best=0,this.world={width:t.width,height:t.height},this.rocks=[],this.lastPipeMs=0,this.accumulator=0,this.images={},this.planeFrames=[],this.frameIndex=0,this.frameTimer=0,this.plane={x:120,y:t.height/2,vy:0,r:28},this._bindInput(),this._loadAssets().then(()=>this._resizeToFit()),window.addEventListener("resize",()=>this._resizeToFit()),this._loop=this._loop.bind(this),requestAnimationFrame(this._loop)}async _loadAssets(){let t=e=>new Promise((s,n)=>{let a=new Image;a.src=e,a.onload=()=>s(a),a.onerror=n});this.images.bg=await t(this.assets.bg),this.images.rock=await t(this.assets.rock),this.images.rockDown=await t(this.assets.rockDown);for(let e of this.assets.planeFrames)this.planeFrames.push(await t(e));if(this.skins){for(let e of Object.keys(this.skins)){let s=[];for(let n of this.skins[e])s.push(await t(n));this.skins[e]=s}this._applySkin(this.currentSkin)}}_bindInput(){let t=e=>{this.state!=="menu"&&this.state!=="dead"&&this.state!=="paused"&&(this.plane.vy=-this.flags.flapImpulse,this.audio.flap(),e?.preventDefault?.())};this.canvas.addEventListener("pointerdown",t,{passive:!1}),window.addEventListener("keydown",e=>{e.code==="Space"&&t(e),e.code==="KeyP"&&this.pause()})}_resizeToFit(){let{innerWidth:t,innerHeight:e}=window,s=this.canvas.width/this.canvas.height,n=t,a=t/s;a>e&&(a=e,n=e*s),this.canvas.style.width=`${n}px`,this.canvas.style.height=`${a}px`}isRunning(){return this.state==="running"}setSkin(t){!this.skins||!this.skins[t]||(this.currentSkin=t,this._applySkin(t))}_applySkin(t){this.skins&&this.skins[t]&&(this.planeFrames=this.skins[t],this.frameIndex=0)}setOpponents(t){this.ghosts=Array.isArray(t)?t.map(e=>({...e,overtaken:!1})):[]}async start(){this.state!=="menu"&&this.state!=="paused"||(this._reset(),this.state="running",this.onStart?.())}pause(){this.state==="running"&&(this.state="paused",this.onPause?.())}resume(){this.state==="paused"&&(this.state="running",this.onResume?.())}async restart(){this._reset(),this.distanceMeters=0,this.state="running",this.onResume?.()}async continueAfterDeath(){this.state==="dead"&&(this.state="running",this.plane.vy=-this.flags.flapImpulse*.8,this.onResume?.())}_reset(){this.score=0,this.distanceMeters=0,this.rocks=[],this.plane={x:120,y:this.canvas.height/2,vy:0,r:28},this.lastPipeMs=0}_spawnRocks(){let t=this.flags.pipeGap,e=120,s=this.world.height-220,n=Math.random()*(s-e)+e,a=Math.max(40,n-t/2),o=n+t/2,l=this.world.height-o-40,u=this.world.width+40;this.rocks.push({x:u,y:0,w:64,h:a,passed:!1,type:"top"}),this.rocks.push({x:u,y:o,w:64,h:l,passed:!1,type:"bottom"})}_update(t){if(this.state!=="running")return;this.plane.vy+=this.flags.gravity*t,this.plane.y+=this.plane.vy*t,this.distanceMeters+=this.flags.scrollSpeed*t*this.metersPerPixel,this.onDistance?.(this.distanceMeters),this.lastPipeMs+=t*1e3,this.lastPipeMs>=this.flags.pipeIntervalMs&&(this.lastPipeMs=0,this._spawnRocks());let e=this.flags.scrollSpeed;for(let a of this.rocks)a.x-=e*t;this.rocks=this.rocks.filter(a=>a.x+a.w>-80);for(let a=0;a<this.rocks.length;a+=2){let o=this.rocks[a].x+this.rocks[a].w;!this.rocks[a].passed&&o<this.plane.x-this.plane.r&&(this.rocks[a].passed=this.rocks[a+1].passed=!0,this.score+=1,this.audio.score(),this.onScore?.(this.score))}let s=this.plane.y+this.plane.r>this.world.height-20,n=this.plane.y-this.plane.r<0;(s||n||this._collides())&&(this.audio.hit(),this.state="dead",this.onDeath?.(this.score,this.distanceMeters))}_collides(){let t=this.plane.x,e=this.plane.y,s=this.plane.r;for(let n of this.rocks){let a=Math.max(n.x,Math.min(t,n.x+n.w)),o=Math.max(n.y,Math.min(e,n.y+n.h)),l=t-a,u=e-o;if(l*l+u*u<s*s)return!0}return!1}_draw(){let{ctx:t,world:e}=this;t.clearRect(0,0,e.width,e.height),this.images.bg&&t.drawImage(this.images.bg,0,0,e.width,e.height);for(let a of this.rocks){let o=a.type==="top"?this.images.rockDown:this.images.rock;o?t.drawImage(o,a.x,a.y,a.w,a.h):(t.fillStyle="#6f8",t.fillRect(a.x,a.y,a.w,a.h))}this.frameTimer+=1,this.frameTimer%8===0&&(this.frameIndex=(this.frameIndex+1)%this.planeFrames.length);let s=this.planeFrames[this.frameIndex],n=Math.atan2(this.plane.vy,240)*.7;s?this._drawRotated(s,this.plane.x,this.plane.y,64,64,n):(t.fillStyle="#ff6",t.beginPath(),t.arc(this.plane.x,this.plane.y,this.plane.r,0,J),t.fill()),t.fillStyle="rgba(0,0,0,0.15)",t.fillRect(0,e.height-20,e.width,20),this.state==="menu"?this._drawCenterText(this.strings.pressStart):this.state==="paused"?this._drawCenterText(this.strings.pause):this.state==="dead"&&this._drawCenterText(this.strings.collision),this.ghosts&&this.ghosts.length>0&&this._drawGhosts()}_drawRotated(t,e,s,n,a,o){let{ctx:l}=this;l.save(),l.translate(e,s),l.rotate(o),l.drawImage(t,-n/2,-a/2,n,a),l.restore()}_drawCenterText(t){let{ctx:e,world:s}=this;e.fillStyle="rgba(0,0,0,0.4)",e.fillRect(0,0,s.width,s.height),e.fillStyle="#fff",e.font="bold 24px system-ui, Arial",e.textAlign="center",e.fillText(t,s.width/2,s.height/2)}_drawGhosts(){let{ctx:t,world:e}=this,s=e.width*.35;t.save(),t.globalAlpha=.6;for(let n of this.ghosts){if(n.overtaken)continue;let a=n.targetDistance-this.distanceMeters,o=Math.max(-s,Math.min(s,a/this.metersPerPixel)),l=this.plane.x+o,u=this.plane.y-80,f=this.planeFrames[this.frameIndex];f&&this._drawRotated(f,l,u,64,64,0),t.fillStyle="white",t.font="12px system-ui, Arial",t.textAlign="center",t.fillText(n.name,l,u-40),a<=0&&(n.overtaken=!0,this.onOvertake?.(n.name))}t.restore(),this.ghosts=this.ghosts.filter(n=>!n.overtaken)}_loop(t){this._lastTs||(this._lastTs=t);let e=Math.min(.033,(t-this._lastTs)/1e3);this._lastTs=t,this._update(e),this._draw(),requestAnimationFrame(this._loop)}};var _=class{constructor(t,e){this.ysdk=t,this.deaths=0,this.interstitialEveryNDeaths=e?.interstitialEveryNDeaths||2,this.bannerInstance=null}trackDeath(){this.deaths+=1}shouldShowInterstitial(){return!this.ysdk||this.interstitialEveryNDeaths<=0?!1:this.deaths>0&&this.deaths%this.interstitialEveryNDeaths===0}async showInterstitial(){if(this.ysdk?.adv?.showInterstitial)return new Promise((t,e)=>{this.ysdk.adv.showInterstitial({callbacks:{onOpen:()=>{this._stopGameplay()},onClose:s=>{this._startGameplay(),t(s)},onOffline:()=>{this._startGameplay(),t(!1)},onError:s=>{this._startGameplay(),e(s)}}})})}async showRewarded(){return this.ysdk?.adv?.showRewardedVideo?new Promise((t,e)=>{this.ysdk.adv.showRewardedVideo({callbacks:{onOpen:()=>{this._stopGameplay()},onRewarded:()=>{},onClose:s=>{this._startGameplay(),s?t(!0):e(new Error("no-reward"))},onError:s=>{this._startGameplay(),e(s)}}})}):Promise.reject(new Error("Rewarded not supported"))}async mountBanner(t){if(!this.ysdk?.adv?.createBannerAdv)return;let e=document.querySelector(t);if(e)try{this.bannerInstance=await this.ysdk.adv.createBannerAdv({containerId:void 0,type:"sticky",rtl:!1}),this.bannerInstance?.render&&await this.bannerInstance.render(e)}catch(s){console.warn("Banner failed",s)}}_stopGameplay(){try{this.ysdk.features.GameplayAPI.stop()}catch{}}_startGameplay(){try{this.ysdk.features.GameplayAPI.start()}catch{}}};var P=class{constructor(t,e){this.ysdk=t,this.boardName=e,this.lb=null,this.ready=this._init()}async _init(){if(!this.ysdk?.getLeaderboards)return null;try{return this.lb=await this.ysdk.getLeaderboards(),this.lb}catch(t){return console.warn("Leaderboards init failed",t),null}}async submitScore(t){if(await this.ready,!!this.lb)try{await this.lb.setLeaderboardScore(this.boardName,t)}catch(e){console.warn("submitScore failed",e)}}async getTop({includeUser:t=!0,quantityTop:e=10}={}){if(await this.ready,!this.lb)return[];try{let s=await this.lb.getLeaderboardEntries(this.boardName,{quantityTop:e,includeUser:t});return s?.entries?.map(n=>({rank:n.rank,name:n.player?.publicName||"\u0418\u0433\u0440\u043E\u043A",score:n.score,me:!!n.player&&n.player.uniqueID===s.userRank?.player?.uniqueID}))||[]}catch(s){return console.warn("getTop failed",s),[]}}async getRandomOpponents(t=3){return(await this.getTop({includeUser:!0,quantityTop:50})).filter(a=>!a.me&&a.score>0).sort(()=>Math.random()-.5).slice(0,t)}};var E=class{constructor(){this.ctx=null,this._muted=!1}isMuted(){return this._muted}setMuted(t){this._muted=!!t}_ensureCtx(){if(!this.ctx){let t=window.AudioContext||window.webkitAudioContext;t&&(this.ctx=new t)}}async beep({frequency:t=440,durationMs:e=100,type:s="sine",volume:n=.05}={}){if(this._muted||(this._ensureCtx(),!this.ctx))return;let a=this.ctx.currentTime,o=this.ctx.createOscillator(),l=this.ctx.createGain();l.gain.value=n,o.type=s,o.frequency.setValueAtTime(t,a),o.connect(l).connect(this.ctx.destination),o.start(),o.stop(a+e/1e3)}flap(){return this.beep({frequency:700,durationMs:60,type:"sine",volume:.06})}score(){return this.beep({frequency:900,durationMs:90,type:"triangle",volume:.07})}hit(){return this.beep({frequency:140,durationMs:150,type:"square",volume:.07})}};var D=class{constructor(t){this.ysdk=t,this.key="flappy-plane"}async _player(){try{return await this.ysdk.getPlayer({signed:!1})}catch{return null}}async getBestScore(){let t=await this._player();if(t&&t.getData)try{return(await t.getData([this.key]))?.[this.key]?.best||0}catch{}try{return JSON.parse(localStorage.getItem(this.key)||"{}").best||0}catch{return 0}}async updateBestScore(t,e){let s=await this.getBestScore(),n=Math.max(s,t);return await this._save({best:n},e),n}async getBestDistance(){try{return JSON.parse(localStorage.getItem(this.key)||"{}").bestDistance||0}catch{return 0}}async updateBestDistance(t){let e=JSON.parse(localStorage.getItem(this.key)||"{}"),s=Math.max(e.bestDistance||0,Math.floor(t));e.bestDistance=s,localStorage.setItem(this.key,JSON.stringify(e));let n=await this._player();if(n&&n.setData)try{await n.setData({[this.key]:e})}catch{}return s}async getSelectedSkin(){return JSON.parse(localStorage.getItem(this.key)||"{}").selectedSkin||"blue"}async setSelectedSkin(t){let e=JSON.parse(localStorage.getItem(this.key)||"{}");e.selectedSkin=t,localStorage.setItem(this.key,JSON.stringify(e));let s=await this._player();if(s&&s.setData)try{await s.setData({[this.key]:e})}catch{}}async getSetting(t){try{return JSON.parse(localStorage.getItem(this.key)||"{}").settings?.[t]}catch{return}}async setSetting(t,e){let s=JSON.parse(localStorage.getItem(this.key)||"{}");s.settings=s.settings||{},s.settings[t]=e,localStorage.setItem(this.key,JSON.stringify(s));let n=await this._player();if(n&&n.setData)try{await n.setData({[this.key]:s})}catch{}}async _save(t,e){let n={...JSON.parse(localStorage.getItem(this.key)||"{}"),...t};localStorage.setItem(this.key,JSON.stringify(n));let a=e||await this._player();if(a&&a.setData)try{await a.setData({[this.key]:n})}catch{}}};var M=class{constructor(t){this.scoreEl=document.querySelector("#hud .score"),this.menu=document.getElementById("menu"),this.settings=document.getElementById("settings"),this.leaderboard=document.getElementById("leaderboard"),this.death=document.getElementById("death"),this.toast=document.getElementById("toast"),this.chkSound=document.getElementById("chk-sound"),this.chkGhosts=document.getElementById("chk-ghosts"),this.selSkin=document.getElementById("sel-skin"),document.getElementById("btn-start").addEventListener("click",t.onStart),document.getElementById("btn-leaderboard").addEventListener("click",t.onOpenLeaderboard),document.getElementById("btn-settings").addEventListener("click",t.onOpenSettings),document.getElementById("btn-back-settings").addEventListener("click",t.onBackFromSettings),document.getElementById("btn-back-lb").addEventListener("click",t.onBackFromLeaderboard),document.getElementById("btn-restart").addEventListener("click",t.onRestart),document.getElementById("btn-rewarded").addEventListener("click",t.onRewarded),document.getElementById("btn-pause").addEventListener("click",t.onPause),document.getElementById("btn-sound").addEventListener("click",()=>{let e=!this.chkSound.checked;this.chkSound.checked=e,t.onToggleSound(e)}),document.getElementById("btn-fullscreen").addEventListener("click",t.onToggleFullscreen),this.chkSound.addEventListener("change",e=>t.onToggleSound(e.target.checked)),this.onToggleGhosts=t.onToggleGhosts||(()=>{}),this.onChangeSkin=t.onChangeSkin||(()=>{}),this.chkGhosts.addEventListener("change",e=>this.onToggleGhosts(e.target.checked)),this.selSkin.addEventListener("change",e=>this.onChangeSkin(e.target.value))}showMenu(t){this._toggle(this.menu,t)}showSettings(t){this._toggle(this.settings,t)}showLeaderboard(t){this._toggle(this.leaderboard,t)}showDeathPanel(t){this._toggle(this.death,t)}showDeath(t,e){this.showDeathPanel(!0),document.getElementById("death-score").textContent=String(t),this.toastMsg(`\u041B\u0443\u0447\u0448\u0438\u0439: ${e}`)}setScore(t){this.scoreEl.textContent=String(t)}renderLeaderboard(t,e){let s=document.getElementById("lb-list");s.innerHTML="";let n=t.map(a=>`<div>#${a.rank} \u2014 ${$(a.name)} \u2014 ${a.score}${a.me?" (\u0432\u044B)":""}</div>`);e&&!t.some(a=>a.me)&&n.unshift(`<div>\u0412\u0430\u0448 \u043B\u043E\u043A\u0430\u043B\u044C\u043D\u044B\u0439 \u0440\u0435\u043A\u043E\u0440\u0434: ${e}</div>`),s.innerHTML=n.join("")}setSoundChecked(t){this.chkSound.checked=!!t}toastMsg(t,e=2e3){this.toast.textContent=t,this.toast.classList.add("visible"),setTimeout(()=>this.toast.classList.remove("visible"),e)}setGhostsChecked(t){this.chkGhosts&&(this.chkGhosts.checked=!!t)}renderSkinOptions(t,e){if(this.selSkin){this.selSkin.innerHTML="";for(let s of t){let n=document.createElement("option");n.value=s.id,n.textContent=s.label+(s.locked?` (\u{1F512} ${s.threshold}\u043C)`:""),n.disabled=!!s.locked,s.id===e&&(n.selected=!0),this.selSkin.appendChild(n)}}}showOvertake(t){this.toastMsg(`\u041E\u0431\u043E\u0433\u043D\u0430\u043D: ${t}`)}_toggle(t,e){t&&(e?t.classList.add("visible"):t.classList.remove("visible"))}};function $(r){return String(r).replace(/[&<>"]+/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"})[t])}function N(r){let t=(r||"ru").toLowerCase(),e={title:"\u0422\u0430\u043F-\u0422\u0430\u043F \u0441\u0430\u043C\u043E\u043B\u0435\u0442",start:"\u041D\u0430\u0447\u0430\u0442\u044C",leaderboard:"\u041B\u0438\u0434\u0435\u0440\u0431\u043E\u0440\u0434",settings:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438",sound:"\u0417\u0432\u0443\u043A",ghosts:"\u0420\u0435\u0436\u0438\u043C \u043F\u0440\u0438\u0437\u0440\u0430\u043A\u043E\u0432",skin:"\u0421\u043A\u0438\u043D \u0441\u0430\u043C\u043E\u043B\u0451\u0442\u0430",back:"\u041D\u0430\u0437\u0430\u0434",youLost:"\u0412\u044B \u043F\u0440\u043E\u0438\u0433\u0440\u0430\u043B\u0438",watchAd:"\u0421\u043C\u043E\u0442\u0440\u0435\u0442\u044C \u0440\u0435\u043A\u043B\u0430\u043C\u0443 \u0438 \u043F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C",restart:"\u0417\u0430\u043D\u043E\u0432\u043E",best:"\u041B\u0443\u0447\u0448\u0438\u0439",yourLocalRecord:"\u0412\u0430\u0448 \u043B\u043E\u043A\u0430\u043B\u044C\u043D\u044B\u0439 \u0440\u0435\u043A\u043E\u0440\u0434",pause:"\u041F\u0430\u0443\u0437\u0430",pressStart:"\u041D\u0430\u0436\u043C\u0438\u0442\u0435 \u0441\u0442\u0430\u0440\u0442",collision:"\u0421\u0442\u043E\u043B\u043A\u043D\u043E\u0432\u0435\u043D\u0438\u0435",overtaken:"\u041E\u0431\u043E\u0433\u043D\u0430\u043D"},s={title:"Tap-Tap Plane",start:"Start",leaderboard:"Leaderboard",settings:"Settings",sound:"Sound",ghosts:"Ghost race",skin:"Plane skin",back:"Back",youLost:"You lost",watchAd:"Watch ad and continue",restart:"Restart",best:"Best",yourLocalRecord:"Your local record",pause:"Paused",pressStart:"Press start",collision:"Collision",overtaken:"Overtaken"};return t.startsWith("ru")?e:s}var H="game",W="flappy_plane_best",q={blue:["Planes/planeBlue1.png","Planes/planeBlue2.png","Planes/planeBlue3.png"],green:["Planes/planeGreen1.png","Planes/planeGreen2.png","Planes/planeGreen3.png"],red:["Planes/planeRed1.png","Planes/planeRed2.png","Planes/planeRed3.png"],yellow:["Planes/planeYellow1.png","Planes/planeYellow2.png","Planes/planeYellow3.png"]},z=[{id:"blue",label:"\u0421\u0438\u043D\u0438\u0439",threshold:0},{id:"green",label:"\u0417\u0435\u043B\u0451\u043D\u044B\u0439",threshold:500},{id:"red",label:"\u041A\u0440\u0430\u0441\u043D\u044B\u0439",threshold:1e3},{id:"yellow",label:"\u0416\u0451\u043B\u0442\u044B\u0439",threshold:1500}],c=null,p=null,w=null,B=null,b=null,d=null,h=null;(async function(){try{c=await G()}catch(i){console.warn("Yandex SDK failed to init, running in degraded mode",i)}let t=c?T(c):{appId:"local",lang:"ru",tld:"ru",payload:null},e=c?.deviceInfo?.type||"desktop",s=N(t.lang),n={gravity:2200,flapImpulse:620,scrollSpeed:220,pipeGap:180,pipeIntervalMs:1450,interstitialEveryNDeaths:2,showBannerOnMenu:!1,metersPerPixel:.2},a={lang:t.lang,deviceType:e},o=c?await A(c,n,a):n,l=document.getElementById(H);function u(){let i=Math.min(window.devicePixelRatio||1,2),g=l.parentElement,S=g.clientWidth,y=g.clientHeight,R=480,Y=800;l.width=Math.floor(R*i),l.height=Math.floor(Y*i),l.style.width="100%",l.style.height="100%",l.getContext("2d").setTransform(i,0,0,i,0,0)}u(),new ResizeObserver(u).observe(document.getElementById("app")),b=new E,d=new D(c),w=new _(c,{interstitialEveryNDeaths:o.interstitialEveryNDeaths}),B=new P(c,W),h=new M({onStart:U,onPause:K,onResume:V,onRestart:j,onRewarded:X,onOpenSettings:()=>h.showSettings(!0),onBackFromSettings:()=>h.showSettings(!1),onOpenLeaderboard:async()=>{h.showLeaderboard(!0);let i=await B.getTop({includeUser:!0}).catch(()=>[]),g=await d.getBestScore();h.renderLeaderboard(i,g)},onBackFromLeaderboard:()=>h.showLeaderboard(!1),onToggleSound:i=>{b.setMuted(!i),d.setSetting("muted",!i)},onToggleFullscreen:async()=>{if(!c)return;let i=c.screen.fullscreen;i.isSupported()&&(i.isFullscreen()?await i.exit():await i.request())}}),Z(s);let f=c?await c.getPlayer({signed:!1}).catch(()=>null):null,x=await d.getSetting("muted");x!==void 0&&b.setMuted(!!x),h.setSoundChecked(!b.isMuted());let L=await d.getBestDistance(),m=await d.getSelectedSkin(),k=C(L);k.some(i=>i.id===m&&!i.locked)||(m=k.filter(i=>!i.locked).slice(-1)[0].id,await d.setSelectedSkin(m)),h.renderSkinOptions(k,m);let v=await d.getSetting("ghosts")!==!1;h.setGhostsChecked(v),p=new I({canvas:l,assets:{bg:"background.png",rock:"rock.png",rockDown:"rockDown.png",planeFrames:q[m].map(i=>i.replace("/Planes/","Planes/"))},audio:b,flags:o,skins:q,selectedSkin:m,strings:{pressStart:s.pressStart,pause:s.pause,collision:s.collision},onScore:i=>h.setScore(i),onDistance:async i=>{},onOvertake:i=>h.showOvertake(i),onDeath:async(i,g)=>{c?.features?.GameplayAPI?.stop();let S=await d.updateBestScore(i,f),y=await d.updateBestDistance(g);await B.submitScore(i).catch(()=>{}),h.showDeath(i,S);let R=C(y);h.renderSkinOptions(R,await d.getSelectedSkin()),w.trackDeath()},onStart:()=>{c?.features?.GameplayAPI?.start(),h.setScore(0),h.showMenu(!1),h.showDeathPanel(!1)},onPause:()=>c?.features?.GameplayAPI?.stop(),onResume:()=>c?.features?.GameplayAPI?.start()});async function O(){if(!v||!c){p.setOpponents([]);return}let i=await B.getRandomOpponents(3).catch(()=>[]),g=o.scrollSpeed*(o.pipeIntervalMs/1e3)*o.metersPerPixel,S=i.map(y=>({name:y.name,targetDistance:y.score*g}));p.setOpponents(S)}O(),c&&o.showBannerOnMenu&&w.mountBanner("#banner-slot").catch(()=>{}),document.addEventListener("visibilitychange",()=>{document.hidden?(p.pause(),c?.features?.GameplayAPI?.stop()):p.isRunning()&&c?.features?.GameplayAPI?.start()}),h.showMenu(!0),F();function C(i){return z.map(g=>({...g,locked:i<g.threshold}))}function F(){h.onToggleGhosts=async i=>{await d.setSetting("ghosts",!!i),O()},h.onChangeSkin=async i=>{if(!C(await d.getBestDistance()).some(y=>y.id===i&&!y.locked)){h.toastMsg("\u0421\u043A\u0438\u043D \u0435\u0449\u0451 \u043D\u0435 \u043E\u0442\u043A\u0440\u044B\u0442");return}await d.setSelectedSkin(i),p.setSkin(i)}}})();async function U(){await Q(),await p.start()}async function K(){p.pause()}async function V(){p.resume()}async function j(){w.shouldShowInterstitial()&&await w.showInterstitial().catch(()=>{}),await p.restart()}async function X(){if(!c)return p.restart();try{await w.showRewarded(),await p.continueAfterDeath()}catch{await p.restart()}}async function Q(){if(!c)return;let r=await c.getPlayer({signed:!1}).catch(()=>null);(!r||r.getMode&&r.getMode()!=="lite")&&await c.auth.openAuthDialog().catch(()=>{})}function Z(r){document.title=`${r.title} \u2014 Yandex Games`;let t=a=>document.querySelector(a);t("#menu h1").textContent=r.title,t("#btn-start").textContent=r.start,t("#btn-leaderboard").textContent=r.leaderboard,t("#btn-settings").textContent=r.settings,t("#settings h2").textContent=r.settings,t("label[for='sel-skin']")?.remove();let e=document.querySelector("#settings .toggle:nth-of-type(3)");if(e){let a=document.createElement("label");a.htmlFor="sel-skin",a.textContent=r.skin,e.prepend(a)}document.querySelector("label[for='sel-skin']"),document.querySelector("label[for='sel-skin']");let s=document.querySelector("#settings .toggle span");s&&(s.textContent=r.sound);let n=document.querySelectorAll("#settings .toggle span")[1];n&&(n.textContent=r.ghosts),document.querySelector("#btn-back-settings").textContent=r.back,document.querySelector("#leaderboard h2").textContent=r.leaderboard,document.querySelector("#btn-back-lb").textContent=r.back,document.querySelector("#death h2").textContent=r.youLost,document.querySelector("#btn-rewarded").textContent=r.watchAd,document.querySelector("#btn-restart").textContent=r.restart}})();
